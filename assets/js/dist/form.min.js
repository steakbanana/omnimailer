"use strict";function _slicedToArray(a,b){return _arrayWithHoles(a)||_iterableToArrayLimit(a,b)||_unsupportedIterableToArray(a,b)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function _iterableToArrayLimit(a,b){var c=null==a?null:"undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(null!=c){var d,e,f=[],g=!0,h=!1;try{for(c=c.call(a);!(g=(d=c.next()).done)&&(f.push(d.value),!(b&&f.length===b));g=!0);}catch(a){h=!0,e=a}finally{try{g||null==c["return"]||c["return"]()}finally{if(h)throw e}}return f}}function _arrayWithHoles(a){if(Array.isArray(a))return a}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var OmniMailerForm=function(){function a(b){_classCallCheck(this,a),this.form=b,this.handle=this.form.getAttribute("data-omnimailer-form-handle"),this.overlay=this.getOverlay(),this.messagePanel=this.getMessagePanel(),this.submitButton=this.getSubmitButton(),this.isValid=!1}return _createClass(a,[{key:"init",value:function(){var a=this;this.messagePanel.closeButton.addEventListener("click",function(b){b.preventDefault(),a.clearMessagePanel()})}},{key:"getOverlay",value:function(){return this.form.querySelector(".loader-overlay")}},{key:"getMessagePanel",value:function(){return{panel:this.form.querySelector(".omnimailer-form-message"),heading:this.form.querySelector(".omnimailer-form-message-heading"),text:this.form.querySelector(".omnimailer-form-message-text"),closeButton:this.form.querySelector(".omnimailer-form-message-close-button")}}},{key:"getSubmitButton",value:function(){return this.form.querySelector("button[type=submit]")}},{key:"showMessage",value:function(a,b){this.messagePanel.heading.textContent=a,this.messagePanel.text.textContent=b,this.messagePanel.panel.classList.remove("hide"),this.messagePanel.panel.scrollIntoView()}},{key:"clearMessagePanel",value:function(){this.messagePanel.panel.classList.add("hide"),this.messagePanel.heading.textContent="",this.messagePanel.text.textContent="",this.messagePanel.panel.classList.remove("success","error")}},{key:"showSuccessMessage",value:function(a,b){this.clearMessagePanel(),this.messagePanel.panel.classList.add("success"),this.showMessage(a,b)}},{key:"showErrorMessage",value:function(a,b){this.clearMessagePanel(),this.messagePanel.panel.classList.add("error"),this.showMessage(a,b)}},{key:"validate",value:function(a){for(var b=wp.i18n.__,c=!0,d=0,e=Object.entries(a);d<e.length;d++){var f=_slicedToArray(e[d],2),g=f[0],h=f[1],i=this.form.querySelector("[data-omnimailer-form='"+g+"']");h?this.removeAlert(i):(this.alert(i,b("This field is mandatory.","omnimailer")),c=!1)}var j=this.form.querySelector("[data-omnimailer-form='email']");if(j&&(j.value&&/^([a-zA-Z0-9_.+-])+@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,10})$/.test(j.value)?this.removeAlert(j):(this.alert(j,b("Please enter a valid e-mail address.","omnimailer")),c=!1)),OmniMailer.useHoneypot()){var k=this.form.querySelector(".homepage-field-label"),l=k.querySelector("input");l&&(l.value?(this.removeAlert(l),c=!1):this.alert(l,b("This field is mandatory.","omnimailer")))}return c}},{key:"alert",value:function(a,b){var c=a.nextElementSibling;a.classList.remove("success"),a.classList.add("error"),c&&c.classList.contains("checkbox-label")?c.classList.add("error"):OmniMailerNotificationHandler.showErrorNotification("omnimailer-field-alert",b,a.parentNode)}},{key:"removeAlert",value:function(a){var b=a.nextElementSibling;if(a.classList.remove("error"),a.classList.add("success"),b&&b.classList.contains("checkbox-label"))b.classList.remove("error");else{var c=a.parentNode.querySelector(".omnimailer-field-alert");c&&OmniMailerNotificationHandler.hideNotification(c)}}},{key:"clear",value:function(){this.form.querySelectorAll("input").forEach(function(a){a.classList.remove("success","error"),"checkbox"===a.getAttribute("type")?a.checked=!1:a.value=""})}},{key:"onSubmit",value:function(a){var b=this;a.preventDefault(),this.values={},this.form.querySelectorAll(".mandatory").forEach(function(a){var c=a.getAttribute("data-omnimailer-form");b.values[c]="checkbox"===a.getAttribute("type")?a.checked:a.value}),this.isValid=this.validate(this.values),this.form.querySelectorAll("[data-omnimailer-form]:not(.mandatory)").forEach(function(a){var c=a.getAttribute("data-omnimailer-form");b.values[c]="checkbox"===a.getAttribute("type")?a.checked:a.value})}},{key:"callAPIAndHandleResponse",value:function(a){var b=this;OmniMailerMailgun.callAPI(a).then(function(a){if(!0===a.success)try{var c=a.data.response.code;if(c){var d=b.getResponseText(c);"success"===d.type?(b.showSuccessMessage(d.heading,d.message),b.clear()):b.showErrorMessage(d.heading,d.message)}}catch(a){b.showErrorMessage(OmniMailerMessages.genericErrorHeading,__("The following error occurred while displaying this message: ","omnimailer")+a)}else b.showErrorMessage(OmniMailerMessages.genericErrorHeading,__("Please check your connectivity. If the error persists, try again later.","omnimailer"));b.overlay.classList.add("hide")})}}]),a}();